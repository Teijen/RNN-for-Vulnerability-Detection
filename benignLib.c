#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <math.h>

/*Start declalaction*/
void notSafeCopy(char* src);
void notSafeMerging(char* s);
void notSafeDifferentSizedStrings(char* s);
void concatenateOverStringStrcpy(char* s);
int validateBufferStrcpy(char* s);
void validateIndexOverflowArryStrcpy(int n, char* s);
void flushingAfterStrCpy(char* s);
void notSafeDynamicCopyStrncpy();
/*End declalaction*/

int main(int argc, char* argv[]){
    /*Call start*/
    // notSafeCopy(argv[1]);
    // notSafeMerging(argv[1]);
    // notSafeDifferentSizedStrings(argv[1]);
    // concatenateOverStringStrcpy(argv[1]);
    // validateBufferStrcpy(argv[1]);
	// validateIndexOverflowArryStrcpy(strtol(argv[1], NULL, 10), argv[2]);
	// flushingAfterStrCpy(argv[1]);
    notSafeDynamicCopyStrncpy();
    /*Call end*/

}


/*funcstart*/
void notSafeCopy(char* src){
	char dest[14];
    if(strlen(src) > sizeof(dest)){
        char longer[strlen(src)];
        strcpy(longer, src);
	    printf("Copied string: %s\n", longer);
    }else{
	    strcpy(dest, src);
	    printf("Copied string: %s\n", dest);
    }
}
/*funcend*/
/*funcstart*/
void notSafeMerging(char* s){
	char dest[15] = "Testing second";
	printf("Before: %s", dest);
    if(strlen(s) > sizeof(dest)){
        char longer[strlen(s)];
        strcpy(longer, s);
	    printf("After: %s\n", longer);
    }else{
	    strcpy(dest, s);
	    printf("After: %s\n", dest);
    }
}
/*funcend*/
/*funcstart*/
void notSafeDifferentSizedStrings(char* s){
	char src[40];
	char dest[strlen(s)];
	memset(dest, '\0', sizeof(dest));
	strcpy(src, "This is somesiteilike.com");
	strcpy(dest, src);
	strcpy(dest, s);
	printf("Final copied string : %s\n", dest);
}
/*funcend*/
/*funcstart*/
void concatenateOverStringStrcpy(char* s){
	char* str1;
	char* str2;
	str1 = strdup("String");
    str2 = strdup("test");
    printf("%s\n", str1);
    printf("%s\n", str2);
	char dest[strlen(s)];
	strcpy(dest, s);
}
/*funcend*/
/*funcstart*/
int validateBufferStrcpy(char* s) {
	char buf[80];
	strcpy(buf, "s: ");
	if (strlen(s) < 81){
		strcpy(buf, s);
        printf("%s\n",buf);
        return 0;
    }
    return 0;
}
/*funcend*/
/*funcstart*/
void validateIndexOverflowArryStrcpy(int n, char* s){
    if(n < strlen(s)){
        n = strlen(s);
    }
	char dest[n];
	strcpy(dest, s);
	printf("dest : %s\n", dest);
}
/*funcend*/
/*funcstart*/
void flushingAfterStrCpy(char* s){
    // Might need to remove fgets
   	int t;
	srand((unsigned) time(&t));
	int a = rand()%50;
	int b = rand()%50;
	int c = rand()%50;
	printf("%d, %d, %d\n",a,b,c);
    if(a < strlen(s)){
        a = strlen(s);
    }
	char dest[a];
	strcpy(dest, s);
	printf("%s\n", s);
}
/*funcend*/
/*funcstart*/
void notSafeDynamicCopyStrncpy(){
	int n; 
	char tmp[256];
	printf("Enter size of string:\n");
	scanf("%d", &n);
    if(n<256){
        n = 256;
    }
	char dest[n];
	while((n= getchar()) != '\n' && n != EOF);
	printf("Enter string to store:\n");
	fgets(tmp, 256, stdin);
	strncpy(dest, tmp, strlen(tmp));
	printf("Final %s\n",dest);
}
/*funcend*/